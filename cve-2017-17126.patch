From 4313493243c00826bf5a1cfe7324ba12c5f0131e Mon Sep 17 00:00:00 2001
From: Victor Rodriguez <victor.rodriguez.bahena@intel.com>
Date: Mon, 18 Dec 2017 13:37:20 +0000
Subject: [PATCH] Prevent an illegal memory access in readelf

Patch based on f425ec6600b69e39eb605f3128806ff688137ea8
Prevent an illegal memory access in readelf when attempting to parse a
corrupt ELF file.

PR 22510 * readelf.c (load_debug_section): Fail if there are no section
headers available.
Nick Clifton <nickc@redhat.com>

Rebase for 2.29 branch using section_headers instead of
f`iledata->section_headers to detect corrupt ELF files

Signed-off-by: Victor Rodriguez <victor.rodriguez.bahena@intel.com>
---
 binutils/readelf.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/binutils/readelf.c b/binutils/readelf.c
index fb16df8..1bedd21 100644
--- a/binutils/readelf.c
+++ b/binutils/readelf.c
@@ -13263,6 +13263,9 @@ load_debug_section (enum dwarf_section_display_enum debug, void * file)
   struct dwarf_section * section = &debug_displays [debug].section;
   Elf_Internal_Shdr * sec;
 
+  if (section_headers == NULL)
+      return FALSE;
+
   /* Locate the debug section.  */
   sec = find_section_in_set (section->uncompressed_name, section_subset);
   if (sec != NULL)
-- 
2.15.1

